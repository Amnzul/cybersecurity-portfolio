<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Project: What does my ISP see? Analyzing Packets. Scenario 2: HTTPS </title>
  <link rel="stylesheet" href="../../../styles.css"/>
  <style>
    /* Override: Remove canvas/matrix rain for this page */
    #matrix-rain { display: none !important; }
    body {
      background: #000 !important;
    }
  </style>
</head>
<body>
  <header>
    <h1>Mr. W. - Project: What does my ISP see? Analyzing Packets. Scenario 2: HTTPS</h1>
    <nav>
      <a href="../../../index.html">Portfolio Home</a>
    </nav>
  </header>

<section id="analyzing_packets">

<h2> Project: What does my ISP see? Analyzing Packets. Scenario 2: HTTPS</h2>

<p></p>

<h2>Scenario 2: HTTPS port 443 browsing. Breakdown:</h2>

<p></p>
<h2>Overview</h2>
<p></p>
<p>HTTPS traffic is encrypted, so the contents of a website should not be seen, nor which particular page of a website were retrieved. We should still expect to see the domains visited, and DNS traffic wont be encrypted so domain queries should be visible.</p>
<h2>Setup</h2>

<p>I set up a new virtual machine with Linux Ubuntu installed and Firefox in the first scenario. I am continuing to use the same operating system.</p>
<p>I will again look to capture packets from the same Ubuntu host that is browsing to see what exits the local host, from the Linux Mint hypervisor host, and finally on the OPNSense firewall between my router and the ISP ONT to see what exits my home network. I will also examine the Zenarmor NexGen Firewall Plugin live logs to watch for DNS resolution requests and connections.</p>
<p>I expect to see what domains were visited, but not which specific documents were loaded on those domains, nor their content..</p>
<p></p>
<p></p>
<hr>
<h2>Activity on the local host:</h2>
<p>The websites used will be <a href="https://www.eff.org/issues/free-speech">https://www.eff.org/issues/free-speech</a>, <a href="https://www.eff.org/issues/privacy">https://www.eff.org/issues/privacy</a>, and <a href="https://ssd.eff.org/">https://ssd.eff.org/</a> . These sites all use https, have different url paths, and one has a different subdomain. I set all devices to capture traffic, then load these webpages.</p>

<img src="scenario2httpsurl1.png">

<img src="scenario2httpsurl3.png">

<img src="scenario2httpsurl2.png">

<p>I capture all traffic using tcpdump and write it out to a file.</p>
<pre><code>sudo tcpdump -w scenario2httpsubuntu.pcap</code></pre>
<p></p>
<p>reading the packet capture file and filtering for port 53 shows all the DNS queries. Listed here is the request to resolve <a href="http://www.eff.org" rel="nofollow">http://www.eff.org</a> and ssd.eff.org</p>

<img src="scenario2httpstcpdumpport53.png">

<p>Reading the packet capture file again and filtering for port 80 shows all the HTTP traffic. No traffic used port 80. Excellent. As expected its all encrypted with HTTPS. In the last scenario when we looked at HTTP traffic this showed the content of the HTML file.</p>

<img src="scenario2httpstcpdumpport80.png">

<p></p>
<p>Reading the packet capture file once more and grepping for the keyword “GET” allowed me to see all the file requests that were requested when using the HTTP protocol. With HTTPS everything beyond the domain name is encrypted. No HTML documents or URLs are visible.</p>

<img src="scenario2httpstcpdumpfilterget.png">

<p></p>
<p>Reading the packet capture file and searching for the keyword “HTTPS” only shows a few domain names.</p>

<img src="scenario2httpstcpdumpfilterhttps.png">

<p></p>
<p>HTTPS reduced what we can see from analyzing packets. DNS Requests are visible, but Website URLs, HTML content, etc are not.</p>
<p></p>
<p></p>
<p></p>
<hr>
<h2>Activity seen on the VM’s Host using a Wireshark capture:</h2>
<p>The computer running the virtual machine is a Linux Mint PC, and it is also running Wireshark set to capture the same traffic for comparison.</p>
<p>Wireshark is filtering out port 53 to view DNS queries. Some DNS requests show eff.org.</p>

<img src="scenario2httpsminthypervisorwiresharkport53.png">

<p></p>
<p>Wireshark is filtering port 80 content. No HTTP traffic is available, so we cant see the specific HTML file downloaded from the internet.</p>

<img src="scenario2httpsminthypervisorwiresharkport80.png">

<p></p>
<p>Wireshark is now filtering for HTTP content. Again no HTTP traffic was detected, and no HTML files were visible.</p>

<img src="scenario2httpsminthypervisorwiresharkfilterhttp-1.png">

<p>Wireshark is filtering for the “eff” keyword. We see just the <a href="http://www.eff.org" rel="nofollow">http://www.eff.org</a> and ssd.eff.org domains in the traffic.</p>

<img src="scenario2httpsminthypervisorwiresharkfiltereff.png">

<p></p>
<p>Wireshark looking at port 443 shows a lot of traffic on my home network, but only the domain names are unencrypted.</p>

<img src="scenario2httpsminthypervisorwiresharkport443.png">

<p>DNS requests, and domain names were able to be seen in the traffic but complete website URLs, HTML content, etc, was not.</p>
<p></p>
<hr>
<h2>On the firewall beyond the router:</h2>
<p>Inspecting the live logs on the firewall showed similar information.</p>
<p>Zenarmor allowed me to filter for eff.org and just look at the DNS requests on port 53. There were a lot of them!</p>

<img src="scenario2httpszenarmordns.png">

<p></p>
<p>Zenarmor shows a a port 80 GET request from eff.org but not what file was transferred. Thats interesting because neither of the other sources showed anything on port 80.</p>

<img src="scenario2httpszenarmorweb.png">

<p></p>
<p>We see lots of encrypted connections using port 443 in Zenarmor’s TLS tab, but this only reveals the domain they are connecting to.</p>

<img src="scenario2httpszenarmortls.png">

<p></p>
<p>I loaded the packet capture from this firewall into Wireshark for further analysis.</p>
<p>Wireshark is filtering out port 53 to view DNS queries. Seen in here is the DNS request for eff.org</p>

<img src="scenario2httpsopnpacketcapturewiresharkport53.png">

<p></p>
<p>Wireshark is filtering port 80 content. Nothing is visible.</p>
  
<img src="scenario2httpsopnpacketcapturewiresharkport80.png">

<p></p>
<p>Wireshark filtering for HTTP content. There is no content related to the traffic we generated from eff.org</p>

<img src="scenario2httpsopnpacketcapturewiresharkfilterhttp.png">

<p></p>
<p>Wireshark is filtering for “eff”. This is the exact same traffic we saw from the previous hop in the transit.</p>

<img src="scenario2httpsopnpacketcapturewiresharkfiltereff.png">

<p>Port 443 traffic as seen in Wireshark again shows a lot of traffic, but nothing discernable beyond domains.</p>

<img src="scenario2httpsopnpacketcapturewiresharkport443.png">

<p></p>
<p></p>
<p></p>
<p>DNS traffic is visible but website URLs, HTML content, etc, are all encrypted at this point.</p>
<p>This is the last hop where I can capture packets. This is the same data that is being seen outside my home network. </p>
<p></p>
<p></p>
<hr>
<h2>Conclusion:</h2>
<p>HTTPS encrypted the content of the websites visited, including the URLs and names of HTML files and images. This should prevent usernames and passwords from being exposed, as well as cookies, and query strings.</p>
<p>Using HTTPS my ISP should only be able to see which domains and addresses the computers on my network are communicating with.</p>
<p>Moving from HTTP to HTTPS significantly improves the security of data in transit.</p>



  
<p>That’s it!</p>
<p></p>
<p></p>
<p></p>
    
</section>

</body>
</html>
